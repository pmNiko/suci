{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/nikolas/Documents/React/Proyecto Final/suci/src/components/layout/mozo/Order.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { Grid, Box, Checkbox } from \"@material-ui/core/\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport AddCircleOutlineIcon from \"@material-ui/icons/AddCircleOutline\";\nimport RemoveCircleOutlineIcon from \"@material-ui/icons/RemoveCircleOutline\";\nimport DeleteSweepIcon from \"@material-ui/icons/DeleteSweep\";\nimport Table from \"@material-ui/core/Table\";\nimport Paper from \"@material-ui/core/Paper\";\nimport TableBody from \"@material-ui/core/TableBody\";\nimport TableCell from \"@material-ui/core/TableCell\";\nimport TableContainer from \"@material-ui/core/TableContainer\";\nimport TableHead from \"@material-ui/core/TableHead\";\nimport TableRow from \"@material-ui/core/TableRow\";\nimport OrderFooter from \"./OrderFooter\";\nimport { connect } from \"react-redux\";\nimport { removeItem, incrementItem, decrementItem, removeOrder, dishesPreparingToOrder, changeDishDelivered, changeDishReady, billOrder } from \"../../../redux/actions/orderAction\";\nimport { resetTable } from \"../../../redux/actions/tableAction\"; // consulta a la  API Graphql\n\nimport { useMutation } from \"@apollo/react-hooks\";\nimport { REMOVE_ITEM, INCREMENT_ITEM, DECREMENT_ITEM, REMOVE_ORDER, DISHES_PREPARING, DISH_DELIVERED, DISH_READY, CLOSE_ORDER } from \"../../../services/Mutations\";\nimport { useHistory } from \"react-router-dom\";\nimport { useParams } from \"react-router-dom\"; //----- Componente de Menu de Items ---- //\n\nconst Order = ({\n  orders,\n  remove,\n  inc,\n  dec,\n  removeOrder,\n  resetTable,\n  dishesPreparing,\n  changeDishDelivered,\n  changeDishReady,\n  billOrder\n}) => {\n  _s();\n\n  var _order$dishes;\n\n  const history = useHistory(); // Recupera el id de la comanda que llega por parametro para filtrar\n  // la comanda a gestionar.\n\n  const {\n    order_id_param\n  } = useParams();\n  const order = orders.filter(order => order._id === order_id_param)[0]; // Estados de los botones facturar y ordenar -> useEffect\n\n  const [desability_bill, setDesability_bill] = useState(true);\n  const [desability_send_kitchen, setDesability_send_kitchen] = useState(true);\n  useEffect(() => {\n    if (order.dishes === undefined) {\n      setDesability_send_kitchen(true);\n    } else {\n      if (order.dishes.length >= 0) {\n        let dishes_pending = order.dishes.filter(dish => dish.state === \"pending\");\n        setDesability_send_kitchen(!dishes_pending.length > 0);\n      } else {\n        setDesability_send_kitchen(true);\n      }\n    }\n  }, [orders]);\n  useEffect(() => {\n    if (order.dishes === undefined) {\n      setDesability_bill(true);\n    } else {\n      if (order.dishes.length >= 0) {\n        let dishes_delivered = order.dishes.filter(dish => dish.state === \"delivered\");\n        let hability = order.dishes.length === dishes_delivered.length;\n        let disable = order.dishes.length > 0 && hability;\n        setDesability_bill(!disable);\n      } else {\n        setDesability_bill(true);\n      }\n    }\n  }, [orders]); // Eliminación de un plato de la comanda\n\n  const [popDishToOrder] = useMutation(REMOVE_ITEM);\n\n  const removeDish = async (item, order_id) => {\n    await popDishToOrder({\n      variables: {\n        order_id: order_id,\n        dish_id: item._id\n      }\n    }).then(result => {\n      let {\n        dishes\n      } = result.data.popDishToOrder; // console.log(dishes); //ya no se encuentra el item incluido\n\n      remove({ ...item,\n        order_id\n      });\n    }).catch(error => {\n      console.log(error);\n    });\n  }; // Incrementa la cantidad de un item de un plato\n\n\n  const [incrementDishToOrder] = useMutation(INCREMENT_ITEM);\n\n  const incrementDish = async (item, order_id) => {\n    await incrementDishToOrder({\n      variables: {\n        order_id: order_id,\n        dish_id: item._id\n      }\n    }).then(result => {\n      let {\n        dishes\n      } = result.data.incrementDishToOrder; // console.log(\"Dishes: \", dishes); //aumento la cantidad\n\n      inc({ ...item,\n        order_id\n      });\n    }).catch(error => {\n      console.log(error);\n    });\n  }; // Decrementa la cantidad de un item de un plato\n\n\n  const [decrementDishToOrder] = useMutation(DECREMENT_ITEM);\n\n  const decrementDish = async (item, order_id) => {\n    await decrementDishToOrder({\n      variables: {\n        order_id: order_id,\n        dish_id: item._id\n      }\n    }).then(result => {\n      let {\n        dishes\n      } = result.data.decrementDishToOrder; // console.log(\"Dishes: \", dishes); //aumento la cantidad\n\n      dec({ ...item,\n        order_id\n      });\n    }).catch(error => {\n      console.log(error);\n    });\n  }; // Elimina la comanda\n\n\n  const [deleteOrder] = useMutation(REMOVE_ORDER);\n\n  const popOrder = async (order_id, table) => {\n    await deleteOrder({\n      variables: {\n        order_id: order_id\n      }\n    }).then(result => {\n      // let { order } = result.data.deleteOrder;\n      history.push(\"/floor\");\n      removeOrder(order_id);\n      resetTable(table);\n    }).catch(error => {\n      console.log(error);\n    });\n  }; // Cambia el estado de los platos y los envia a cocina\n\n\n  const [dishPreparingToOrder] = useMutation(DISHES_PREPARING);\n\n  const sendKitchen = async () => {\n    let order_id = order._id;\n    let dishes_pending = order.dishes.filter(dish => dish.state === \"pending\");\n    let dishes = [];\n    dishes_pending.map(dish => dishes.push(dish._id));\n    dishesPreparing({\n      dishes,\n      order_id\n    });\n    await dishPreparingToOrder({\n      variables: {\n        order_id: order_id,\n        dishes: dishes\n      }\n    }).then(result => {\n      let {\n        dishes\n      } = result.data.dishPreparingToOrder;\n    }).catch(error => {\n      console.log(error);\n    });\n  }; // Checked de entrega. Gestiona la entrega de platos\n\n\n  const [dishDelivered] = useMutation(DISH_DELIVERED);\n  const [dishReady] = useMutation(DISH_READY);\n\n  const onTable = async (order_id, dish) => {\n    let dish_id = dish._id;\n\n    if (dish.state === \"ready\") {\n      changeDishDelivered({\n        order_id,\n        dish_id\n      });\n      await dishDelivered({\n        variables: {\n          order_id: order_id,\n          dish_id: dish_id\n        }\n      }).then(result => {\n        let {\n          order\n        } = result.data.dishDelivered;\n      }).catch(error => {\n        console.log(error);\n      });\n    } else {\n      changeDishReady({\n        order_id,\n        dish_id\n      });\n      await dishReady({\n        variables: {\n          order_id: order_id,\n          dish_id: dish_id\n        }\n      }).then(result => {\n        let {\n          order\n        } = result.data.dishReady;\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n  }; // Gestiona el cierre de la comanda\n\n\n  const [closeOrder] = useMutation(CLOSE_ORDER);\n\n  const bill = async () => {\n    let items = order.dishes.length;\n    let total_delivered = order.dishes.filter(dish => dish.state === \"delivered\").length;\n\n    if (items === total_delivered && items > 0) {\n      let order_id = order._id;\n      billOrder(order_id);\n      resetTable(order.table);\n      history.push(\"/\");\n      await closeOrder({\n        variables: {\n          order_id: order_id\n        }\n      }).then(result => {// let { order } = result.data.closeOrder\n      }).catch(error => {\n        console.log(error);\n      });\n    } else {\n      alert(\"Aun no se puede facturar\");\n    }\n  };\n  /*\n    Componente de comanda \n  */\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 0,\n      justify: \"center\",\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        md: 12,\n        children: /*#__PURE__*/_jsxDEV(TableContainer, {\n          children: /*#__PURE__*/_jsxDEV(Table, {\n            \"aria-label\": \"simple table\",\n            children: [/*#__PURE__*/_jsxDEV(TableHead, {\n              children: /*#__PURE__*/_jsxDEV(TableRow, {\n                children: [/*#__PURE__*/_jsxDEV(TableCell, {\n                  children: [\"Comanda \", order === null || order === void 0 ? void 0 : order.number]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 275,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                  children: [\"Mesa: \", order === null || order === void 0 ? void 0 : order.table, \" \"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 276,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                  children: [\"Fecha: \", order === null || order === void 0 ? void 0 : order.date]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 277,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                  children: [\"Hora: \", order === null || order === void 0 ? void 0 : order.time, \" \"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 278,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                  children: [/*#__PURE__*/_jsxDEV(IconButton, {\n                    \"aria-label\": \"RemoveCircleOutlineIcon\",\n                    children: /*#__PURE__*/_jsxDEV(DeleteSweepIcon, {\n                      fontSize: \"small\",\n                      onClick: () => {\n                        popOrder(order._id, order.table);\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 281,\n                      columnNumber: 23\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 280,\n                    columnNumber: 21\n                  }, this), \" \"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 279,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 274,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 273,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(TableBody, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Paper, {\n        style: {\n          height: 400,\n          width: \"95%\",\n          overflow: \"auto\"\n        },\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          md: 12,\n          children: /*#__PURE__*/_jsxDEV(Box, {\n            m: 2,\n            mb: 3,\n            children: /*#__PURE__*/_jsxDEV(TableContainer, {\n              children: /*#__PURE__*/_jsxDEV(Table, {\n                \"aria-label\": \"simple table\",\n                children: [/*#__PURE__*/_jsxDEV(TableHead, {\n                  children: /*#__PURE__*/_jsxDEV(TableRow, {\n                    children: [/*#__PURE__*/_jsxDEV(TableCell, {\n                      children: \"Eliminar\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 302,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      children: \"Item\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 303,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      align: \"center\",\n                      children: \"Quitar\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 304,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      align: \"center\",\n                      children: \"Cantidad\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 305,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      children: \"Acci\\xF3n\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 306,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      children: \"Estado\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 307,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 301,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 300,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(TableBody, {\n                  children: (_order$dishes = order.dishes) === null || _order$dishes === void 0 ? void 0 : _order$dishes.map(item => /*#__PURE__*/_jsxDEV(TableRow, {\n                    children: [/*#__PURE__*/_jsxDEV(TableCell, {\n                      component: \"th\",\n                      scope: \"row\",\n                      children: /*#__PURE__*/_jsxDEV(IconButton, {\n                        \"aria-label\": \"delete\",\n                        onClick: () => removeDish(item, order._id),\n                        children: /*#__PURE__*/_jsxDEV(DeleteIcon, {\n                          fontSize: \"small\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 318,\n                          columnNumber: 29\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 314,\n                        columnNumber: 27\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 313,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      component: \"th\",\n                      scope: \"row\",\n                      children: item.name\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 321,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      component: \"th\",\n                      scope: \"row\",\n                      align: \"center\",\n                      children: item.state === \"pending\" && item.count > 1 && /*#__PURE__*/_jsxDEV(IconButton, {\n                        \"aria-label\": \"RemoveCircleOutlineIcon\",\n                        onClick: () => decrementDish(item, order._id),\n                        children: /*#__PURE__*/_jsxDEV(RemoveCircleOutlineIcon, {\n                          fontSize: \"small\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 330,\n                          columnNumber: 31\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 326,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 324,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      component: \"th\",\n                      scope: \"row\",\n                      align: \"center\",\n                      children: item.count\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 334,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      component: \"th\",\n                      scope: \"row\",\n                      children: [item.state === \"pending\" && /*#__PURE__*/_jsxDEV(IconButton, {\n                        \"aria-label\": \"AddCircleOutlineIcon\",\n                        onClick: () => incrementDish(item, order._id),\n                        children: /*#__PURE__*/_jsxDEV(AddCircleOutlineIcon, {\n                          fontSize: \"small\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 343,\n                          columnNumber: 31\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 339,\n                        columnNumber: 29\n                      }, this), item.state === \"ready\" && /*#__PURE__*/_jsxDEV(Checkbox, {\n                        checked: false,\n                        onChange: () => {\n                          onTable(order._id, item);\n                        },\n                        color: \"primary\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 347,\n                        columnNumber: 29\n                      }, this), item.state === \"delivered\" && /*#__PURE__*/_jsxDEV(Checkbox, {\n                        checked: true,\n                        onChange: () => {\n                          onTable(order._id, item);\n                        },\n                        color: \"primary\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 356,\n                        columnNumber: 29\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 337,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                      component: \"th\",\n                      scope: \"row\",\n                      children: [item.state === \"pending\" && \"Pendiente\", item.state === \"preparing\" && \"Preparando\", item.state === \"ready\" && \"Listo\", item.state === \"delivered\" && \"En mesa\"]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 365,\n                      columnNumber: 25\n                    }, this)]\n                  }, 1, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 312,\n                    columnNumber: 23\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 310,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 299,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(OrderFooter, {\n        sendKitchen: sendKitchen,\n        bill: bill,\n        desability_send_kitchen: desability_send_kitchen,\n        desability_bill: desability_bill\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 268,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Order, \"71VKP2Tp18Txk/n6jTYamlPI4Mc=\", false, function () {\n  return [useHistory, useParams, useMutation, useMutation, useMutation, useMutation, useMutation, useMutation, useMutation, useMutation];\n});\n\n_c = Order;\n\nconst mapStateToProps = state => {\n  return {\n    orders: state.order.orders\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    remove: item => dispatch(removeItem(item)),\n    inc: item => dispatch(incrementItem(item)),\n    dec: item => dispatch(decrementItem(item)),\n    removeOrder: order_id => dispatch(removeOrder(order_id)),\n    resetTable: number => dispatch(resetTable(number)),\n    dishesPreparing: payload => dispatch(dishesPreparingToOrder(payload)),\n    changeDishDelivered: payload => dispatch(changeDishDelivered(payload)),\n    changeDishReady: payload => dispatch(changeDishReady(payload)),\n    billOrder: payload => dispatch(billOrder(payload))\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Order);\n\nvar _c;\n\n$RefreshReg$(_c, \"Order\");","map":{"version":3,"sources":["/Users/nikolas/Documents/React/Proyecto Final/suci/src/components/layout/mozo/Order.js"],"names":["React","useState","useEffect","Grid","Box","Checkbox","IconButton","DeleteIcon","AddCircleOutlineIcon","RemoveCircleOutlineIcon","DeleteSweepIcon","Table","Paper","TableBody","TableCell","TableContainer","TableHead","TableRow","OrderFooter","connect","removeItem","incrementItem","decrementItem","removeOrder","dishesPreparingToOrder","changeDishDelivered","changeDishReady","billOrder","resetTable","useMutation","REMOVE_ITEM","INCREMENT_ITEM","DECREMENT_ITEM","REMOVE_ORDER","DISHES_PREPARING","DISH_DELIVERED","DISH_READY","CLOSE_ORDER","useHistory","useParams","Order","orders","remove","inc","dec","dishesPreparing","history","order_id_param","order","filter","_id","desability_bill","setDesability_bill","desability_send_kitchen","setDesability_send_kitchen","dishes","undefined","length","dishes_pending","dish","state","dishes_delivered","hability","disable","popDishToOrder","removeDish","item","order_id","variables","dish_id","then","result","data","catch","error","console","log","incrementDishToOrder","incrementDish","decrementDishToOrder","decrementDish","deleteOrder","popOrder","table","push","dishPreparingToOrder","sendKitchen","map","dishDelivered","dishReady","onTable","closeOrder","bill","items","total_delivered","alert","number","date","time","height","width","overflow","name","count","mapStateToProps","mapDispatchToProps","dispatch","payload"],"mappings":";;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,SAASC,IAAT,EAAeC,GAAf,EAAoBC,QAApB,QAAoC,oBAApC;AACA,OAAOC,UAAP,MAAuB,8BAAvB;AACA,OAAOC,UAAP,MAAuB,2BAAvB;AACA,OAAOC,oBAAP,MAAiC,qCAAjC;AACA,OAAOC,uBAAP,MAAoC,wCAApC;AACA,OAAOC,eAAP,MAA4B,gCAA5B;AACA,OAAOC,KAAP,MAAkB,yBAAlB;AACA,OAAOC,KAAP,MAAkB,yBAAlB;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,cAAP,MAA2B,kCAA3B;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,QAAP,MAAqB,4BAArB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SACEC,UADF,EAEEC,aAFF,EAGEC,aAHF,EAIEC,WAJF,EAKEC,sBALF,EAMEC,mBANF,EAOEC,eAPF,EAQEC,SARF,QASO,oCATP;AAUA,SAASC,UAAT,QAA2B,oCAA3B,C,CACA;;AACA,SAASC,WAAT,QAA4B,qBAA5B;AACA,SACEC,WADF,EAEEC,cAFF,EAGEC,cAHF,EAIEC,YAJF,EAKEC,gBALF,EAMEC,cANF,EAOEC,UAPF,EAQEC,WARF,QASO,6BATP;AAUA,SAASC,UAAT,QAA2B,kBAA3B;AAEA,SAASC,SAAT,QAA0B,kBAA1B,C,CAEA;;AAEA,MAAMC,KAAK,GAAG,CAAC;AACbC,EAAAA,MADa;AAEbC,EAAAA,MAFa;AAGbC,EAAAA,GAHa;AAIbC,EAAAA,GAJa;AAKbrB,EAAAA,WALa;AAMbK,EAAAA,UANa;AAObiB,EAAAA,eAPa;AAQbpB,EAAAA,mBARa;AASbC,EAAAA,eATa;AAUbC,EAAAA;AAVa,CAAD,KAWR;AAAA;;AAAA;;AACJ,QAAMmB,OAAO,GAAGR,UAAU,EAA1B,CADI,CAEJ;AACA;;AACA,QAAM;AAAES,IAAAA;AAAF,MAAqBR,SAAS,EAApC;AACA,QAAMS,KAAK,GAAGP,MAAM,CAACQ,MAAP,CAAeD,KAAD,IAAWA,KAAK,CAACE,GAAN,KAAcH,cAAvC,EAAuD,CAAvD,CAAd,CALI,CAOJ;;AACA,QAAM,CAACI,eAAD,EAAkBC,kBAAlB,IAAwCnD,QAAQ,CAAC,IAAD,CAAtD;AACA,QAAM,CAACoD,uBAAD,EAA0BC,0BAA1B,IAAwDrD,QAAQ,CAAC,IAAD,CAAtE;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI8C,KAAK,CAACO,MAAN,KAAiBC,SAArB,EAAgC;AAC9BF,MAAAA,0BAA0B,CAAC,IAAD,CAA1B;AACD,KAFD,MAEO;AACL,UAAIN,KAAK,CAACO,MAAN,CAAaE,MAAb,IAAuB,CAA3B,EAA8B;AAC5B,YAAIC,cAAc,GAAGV,KAAK,CAACO,MAAN,CAAaN,MAAb,CAClBU,IAAD,IAAUA,IAAI,CAACC,KAAL,KAAe,SADN,CAArB;AAGAN,QAAAA,0BAA0B,CAAC,CAACI,cAAc,CAACD,MAAhB,GAAyB,CAA1B,CAA1B;AACD,OALD,MAKO;AACLH,QAAAA,0BAA0B,CAAC,IAAD,CAA1B;AACD;AACF;AACF,GAbQ,EAaN,CAACb,MAAD,CAbM,CAAT;AAeAvC,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI8C,KAAK,CAACO,MAAN,KAAiBC,SAArB,EAAgC;AAC9BJ,MAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACD,KAFD,MAEO;AACL,UAAIJ,KAAK,CAACO,MAAN,CAAaE,MAAb,IAAuB,CAA3B,EAA8B;AAC5B,YAAII,gBAAgB,GAAGb,KAAK,CAACO,MAAN,CAAaN,MAAb,CACpBU,IAAD,IAAUA,IAAI,CAACC,KAAL,KAAe,WADJ,CAAvB;AAGA,YAAIE,QAAQ,GAAGd,KAAK,CAACO,MAAN,CAAaE,MAAb,KAAwBI,gBAAgB,CAACJ,MAAxD;AACA,YAAIM,OAAO,GAAGf,KAAK,CAACO,MAAN,CAAaE,MAAb,GAAsB,CAAtB,IAA2BK,QAAzC;AACAV,QAAAA,kBAAkB,CAAC,CAACW,OAAF,CAAlB;AACD,OAPD,MAOO;AACLX,QAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACD;AACF;AACF,GAfQ,EAeN,CAACX,MAAD,CAfM,CAAT,CA1BI,CA2CJ;;AACA,QAAM,CAACuB,cAAD,IAAmBnC,WAAW,CAACC,WAAD,CAApC;;AACA,QAAMmC,UAAU,GAAG,OAAOC,IAAP,EAAaC,QAAb,KAA0B;AAC3C,UAAMH,cAAc,CAAC;AACnBI,MAAAA,SAAS,EAAE;AACTD,QAAAA,QAAQ,EAAEA,QADD;AAETE,QAAAA,OAAO,EAAEH,IAAI,CAAChB;AAFL;AADQ,KAAD,CAAd,CAMHoB,IANG,CAMGC,MAAD,IAAY;AAChB,UAAI;AAAEhB,QAAAA;AAAF,UAAagB,MAAM,CAACC,IAAP,CAAYR,cAA7B,CADgB,CAEhB;;AACAtB,MAAAA,MAAM,CAAC,EAAE,GAAGwB,IAAL;AAAWC,QAAAA;AAAX,OAAD,CAAN;AACD,KAVG,EAWHM,KAXG,CAWIC,KAAD,IAAW;AAChBC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD,KAbG,CAAN;AAcD,GAfD,CA7CI,CA8DJ;;;AACA,QAAM,CAACG,oBAAD,IAAyBhD,WAAW,CAACE,cAAD,CAA1C;;AACA,QAAM+C,aAAa,GAAG,OAAOZ,IAAP,EAAaC,QAAb,KAA0B;AAC9C,UAAMU,oBAAoB,CAAC;AACzBT,MAAAA,SAAS,EAAE;AACTD,QAAAA,QAAQ,EAAEA,QADD;AAETE,QAAAA,OAAO,EAAEH,IAAI,CAAChB;AAFL;AADc,KAAD,CAApB,CAMHoB,IANG,CAMGC,MAAD,IAAY;AAChB,UAAI;AAAEhB,QAAAA;AAAF,UAAagB,MAAM,CAACC,IAAP,CAAYK,oBAA7B,CADgB,CAEhB;;AACAlC,MAAAA,GAAG,CAAC,EAAE,GAAGuB,IAAL;AAAWC,QAAAA;AAAX,OAAD,CAAH;AACD,KAVG,EAWHM,KAXG,CAWIC,KAAD,IAAW;AAChBC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD,KAbG,CAAN;AAcD,GAfD,CAhEI,CAiFJ;;;AACA,QAAM,CAACK,oBAAD,IAAyBlD,WAAW,CAACG,cAAD,CAA1C;;AACA,QAAMgD,aAAa,GAAG,OAAOd,IAAP,EAAaC,QAAb,KAA0B;AAC9C,UAAMY,oBAAoB,CAAC;AACzBX,MAAAA,SAAS,EAAE;AACTD,QAAAA,QAAQ,EAAEA,QADD;AAETE,QAAAA,OAAO,EAAEH,IAAI,CAAChB;AAFL;AADc,KAAD,CAApB,CAMHoB,IANG,CAMGC,MAAD,IAAY;AAChB,UAAI;AAAEhB,QAAAA;AAAF,UAAagB,MAAM,CAACC,IAAP,CAAYO,oBAA7B,CADgB,CAEhB;;AACAnC,MAAAA,GAAG,CAAC,EAAE,GAAGsB,IAAL;AAAWC,QAAAA;AAAX,OAAD,CAAH;AACD,KAVG,EAWHM,KAXG,CAWIC,KAAD,IAAW;AAChBC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD,KAbG,CAAN;AAcD,GAfD,CAnFI,CAoGJ;;;AACA,QAAM,CAACO,WAAD,IAAgBpD,WAAW,CAACI,YAAD,CAAjC;;AACA,QAAMiD,QAAQ,GAAG,OAAOf,QAAP,EAAiBgB,KAAjB,KAA2B;AAC1C,UAAMF,WAAW,CAAC;AAChBb,MAAAA,SAAS,EAAE;AACTD,QAAAA,QAAQ,EAAEA;AADD;AADK,KAAD,CAAX,CAKHG,IALG,CAKGC,MAAD,IAAY;AAChB;AACAzB,MAAAA,OAAO,CAACsC,IAAR,CAAa,QAAb;AACA7D,MAAAA,WAAW,CAAC4C,QAAD,CAAX;AACAvC,MAAAA,UAAU,CAACuD,KAAD,CAAV;AACD,KAVG,EAWHV,KAXG,CAWIC,KAAD,IAAW;AAChBC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD,KAbG,CAAN;AAcD,GAfD,CAtGI,CAuHJ;;;AACA,QAAM,CAACW,oBAAD,IAAyBxD,WAAW,CAACK,gBAAD,CAA1C;;AACA,QAAMoD,WAAW,GAAG,YAAY;AAC9B,QAAInB,QAAQ,GAAGnB,KAAK,CAACE,GAArB;AACA,QAAIQ,cAAc,GAAGV,KAAK,CAACO,MAAN,CAAaN,MAAb,CAClBU,IAAD,IAAUA,IAAI,CAACC,KAAL,KAAe,SADN,CAArB;AAGA,QAAIL,MAAM,GAAG,EAAb;AACAG,IAAAA,cAAc,CAAC6B,GAAf,CAAoB5B,IAAD,IAAUJ,MAAM,CAAC6B,IAAP,CAAYzB,IAAI,CAACT,GAAjB,CAA7B;AACAL,IAAAA,eAAe,CAAC;AAAEU,MAAAA,MAAF;AAAUY,MAAAA;AAAV,KAAD,CAAf;AACA,UAAMkB,oBAAoB,CAAC;AACzBjB,MAAAA,SAAS,EAAE;AACTD,QAAAA,QAAQ,EAAEA,QADD;AAETZ,QAAAA,MAAM,EAAEA;AAFC;AADc,KAAD,CAApB,CAMHe,IANG,CAMGC,MAAD,IAAY;AAChB,UAAI;AAAEhB,QAAAA;AAAF,UAAagB,MAAM,CAACC,IAAP,CAAYa,oBAA7B;AACD,KARG,EASHZ,KATG,CASIC,KAAD,IAAW;AAChBC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD,KAXG,CAAN;AAYD,GApBD,CAzHI,CA+IJ;;;AACA,QAAM,CAACc,aAAD,IAAkB3D,WAAW,CAACM,cAAD,CAAnC;AACA,QAAM,CAACsD,SAAD,IAAc5D,WAAW,CAACO,UAAD,CAA/B;;AACA,QAAMsD,OAAO,GAAG,OAAOvB,QAAP,EAAiBR,IAAjB,KAA0B;AACxC,QAAIU,OAAO,GAAGV,IAAI,CAACT,GAAnB;;AACA,QAAIS,IAAI,CAACC,KAAL,KAAe,OAAnB,EAA4B;AAC1BnC,MAAAA,mBAAmB,CAAC;AAAE0C,QAAAA,QAAF;AAAYE,QAAAA;AAAZ,OAAD,CAAnB;AACA,YAAMmB,aAAa,CAAC;AAClBpB,QAAAA,SAAS,EAAE;AACTD,UAAAA,QAAQ,EAAEA,QADD;AAETE,UAAAA,OAAO,EAAEA;AAFA;AADO,OAAD,CAAb,CAMHC,IANG,CAMGC,MAAD,IAAY;AAChB,YAAI;AAAEvB,UAAAA;AAAF,YAAYuB,MAAM,CAACC,IAAP,CAAYgB,aAA5B;AACD,OARG,EASHf,KATG,CASIC,KAAD,IAAW;AAChBC,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD,OAXG,CAAN;AAYD,KAdD,MAcO;AACLhD,MAAAA,eAAe,CAAC;AAAEyC,QAAAA,QAAF;AAAYE,QAAAA;AAAZ,OAAD,CAAf;AACA,YAAMoB,SAAS,CAAC;AACdrB,QAAAA,SAAS,EAAE;AACTD,UAAAA,QAAQ,EAAEA,QADD;AAETE,UAAAA,OAAO,EAAEA;AAFA;AADG,OAAD,CAAT,CAMHC,IANG,CAMGC,MAAD,IAAY;AAChB,YAAI;AAAEvB,UAAAA;AAAF,YAAYuB,MAAM,CAACC,IAAP,CAAYiB,SAA5B;AACD,OARG,EASHhB,KATG,CASIC,KAAD,IAAW;AAChBC,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD,OAXG,CAAN;AAYD;AACF,GA/BD,CAlJI,CAmLJ;;;AACA,QAAM,CAACiB,UAAD,IAAe9D,WAAW,CAACQ,WAAD,CAAhC;;AACA,QAAMuD,IAAI,GAAG,YAAY;AACvB,QAAIC,KAAK,GAAG7C,KAAK,CAACO,MAAN,CAAaE,MAAzB;AACA,QAAIqC,eAAe,GAAG9C,KAAK,CAACO,MAAN,CAAaN,MAAb,CACnBU,IAAD,IAAUA,IAAI,CAACC,KAAL,KAAe,WADL,EAEpBH,MAFF;;AAGA,QAAIoC,KAAK,KAAKC,eAAV,IAA6BD,KAAK,GAAG,CAAzC,EAA4C;AAC1C,UAAI1B,QAAQ,GAAGnB,KAAK,CAACE,GAArB;AACAvB,MAAAA,SAAS,CAACwC,QAAD,CAAT;AACAvC,MAAAA,UAAU,CAACoB,KAAK,CAACmC,KAAP,CAAV;AACArC,MAAAA,OAAO,CAACsC,IAAR,CAAa,GAAb;AACA,YAAMO,UAAU,CAAC;AACfvB,QAAAA,SAAS,EAAE;AACTD,UAAAA,QAAQ,EAAEA;AADD;AADI,OAAD,CAAV,CAKHG,IALG,CAKGC,MAAD,IAAY,CAChB;AACD,OAPG,EAQHE,KARG,CAQIC,KAAD,IAAW;AAChBC,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD,OAVG,CAAN;AAWD,KAhBD,MAgBO;AACLqB,MAAAA,KAAK,CAAC,0BAAD,CAAL;AACD;AACF,GAxBD;AA0BA;AACF;AACA;;;AACE,sBACE;AAAA,2BACE,QAAC,IAAD;AAAM,MAAA,SAAS,MAAf;AAAgB,MAAA,OAAO,EAAE,CAAzB;AAA4B,MAAA,OAAO,EAAC,QAApC;AAAA,8BACE,QAAC,IAAD;AAAM,QAAA,IAAI,MAAV;AAAW,QAAA,EAAE,EAAE,EAAf;AAAA,+BACE,QAAC,cAAD;AAAA,iCACE,QAAC,KAAD;AAAO,0BAAW,cAAlB;AAAA,oCACE,QAAC,SAAD;AAAA,qCACE,QAAC,QAAD;AAAA,wCACE,QAAC,SAAD;AAAA,yCAAoB/C,KAApB,aAAoBA,KAApB,uBAAoBA,KAAK,CAAEgD,MAA3B;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF,eAEE,QAAC,SAAD;AAAA,uCAAkBhD,KAAlB,aAAkBA,KAAlB,uBAAkBA,KAAK,CAAEmC,KAAzB;AAAA;AAAA;AAAA;AAAA;AAAA,wBAFF,eAGE,QAAC,SAAD;AAAA,wCAAmBnC,KAAnB,aAAmBA,KAAnB,uBAAmBA,KAAK,CAAEiD,IAA1B;AAAA;AAAA;AAAA;AAAA;AAAA,wBAHF,eAIE,QAAC,SAAD;AAAA,uCAAkBjD,KAAlB,aAAkBA,KAAlB,uBAAkBA,KAAK,CAAEkD,IAAzB;AAAA;AAAA;AAAA;AAAA;AAAA,wBAJF,eAKE,QAAC,SAAD;AAAA,0CACE,QAAC,UAAD;AAAY,kCAAW,yBAAvB;AAAA,2CACE,QAAC,eAAD;AACE,sBAAA,QAAQ,EAAC,OADX;AAEE,sBAAA,OAAO,EAAE,MAAM;AACbhB,wBAAAA,QAAQ,CAAClC,KAAK,CAACE,GAAP,EAAYF,KAAK,CAACmC,KAAlB,CAAR;AACD;AAJH;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,0BADF,EAQgB,GARhB;AAAA;AAAA;AAAA;AAAA;AAAA,wBALF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBADF,eAmBE,QAAC,SAAD;AAAA;AAAA;AAAA;AAAA,oBAnBF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cADF,eA0BE,QAAC,KAAD;AAAO,QAAA,KAAK,EAAE;AAAEgB,UAAAA,MAAM,EAAE,GAAV;AAAeC,UAAAA,KAAK,EAAE,KAAtB;AAA6BC,UAAAA,QAAQ,EAAE;AAAvC,SAAd;AAAA,+BACE,QAAC,IAAD;AAAM,UAAA,IAAI,MAAV;AAAW,UAAA,EAAE,EAAE,EAAf;AAAA,iCACE,QAAC,GAAD;AAAK,YAAA,CAAC,EAAE,CAAR;AAAW,YAAA,EAAE,EAAE,CAAf;AAAA,mCACE,QAAC,cAAD;AAAA,qCACE,QAAC,KAAD;AAAO,8BAAW,cAAlB;AAAA,wCACE,QAAC,SAAD;AAAA,yCACE,QAAC,QAAD;AAAA,4CACE,QAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BADF,eAEE,QAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAFF,eAGE,QAAC,SAAD;AAAW,sBAAA,KAAK,EAAC,QAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAHF,eAIE,QAAC,SAAD;AAAW,sBAAA,KAAK,EAAC,QAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAJF,eAKE,QAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BALF,eAME,QAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BANF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,wBADF,eAWE,QAAC,SAAD;AAAA,6CACGrD,KAAK,CAACO,MADT,kDACG,cAAcgC,GAAd,CAAmBrB,IAAD,iBACjB,QAAC,QAAD;AAAA,4CACE,QAAC,SAAD;AAAW,sBAAA,SAAS,EAAC,IAArB;AAA0B,sBAAA,KAAK,EAAC,KAAhC;AAAA,6CACE,QAAC,UAAD;AACE,sCAAW,QADb;AAEE,wBAAA,OAAO,EAAE,MAAMD,UAAU,CAACC,IAAD,EAAOlB,KAAK,CAACE,GAAb,CAF3B;AAAA,+CAIE,QAAC,UAAD;AAAY,0BAAA,QAAQ,EAAC;AAArB;AAAA;AAAA;AAAA;AAAA;AAJF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,4BADF,eASE,QAAC,SAAD;AAAW,sBAAA,SAAS,EAAC,IAArB;AAA0B,sBAAA,KAAK,EAAC,KAAhC;AAAA,gCACGgB,IAAI,CAACoC;AADR;AAAA;AAAA;AAAA;AAAA,4BATF,eAYE,QAAC,SAAD;AAAW,sBAAA,SAAS,EAAC,IAArB;AAA0B,sBAAA,KAAK,EAAC,KAAhC;AAAsC,sBAAA,KAAK,EAAC,QAA5C;AAAA,gCACGpC,IAAI,CAACN,KAAL,KAAe,SAAf,IAA4BM,IAAI,CAACqC,KAAL,GAAa,CAAzC,iBACC,QAAC,UAAD;AACE,sCAAW,yBADb;AAEE,wBAAA,OAAO,EAAE,MAAMvB,aAAa,CAACd,IAAD,EAAOlB,KAAK,CAACE,GAAb,CAF9B;AAAA,+CAIE,QAAC,uBAAD;AAAyB,0BAAA,QAAQ,EAAC;AAAlC;AAAA;AAAA;AAAA;AAAA;AAJF;AAAA;AAAA;AAAA;AAAA;AAFJ;AAAA;AAAA;AAAA;AAAA,4BAZF,eAsBE,QAAC,SAAD;AAAW,sBAAA,SAAS,EAAC,IAArB;AAA0B,sBAAA,KAAK,EAAC,KAAhC;AAAsC,sBAAA,KAAK,EAAC,QAA5C;AAAA,gCACGgB,IAAI,CAACqC;AADR;AAAA;AAAA;AAAA;AAAA,4BAtBF,eAyBE,QAAC,SAAD;AAAW,sBAAA,SAAS,EAAC,IAArB;AAA0B,sBAAA,KAAK,EAAC,KAAhC;AAAA,iCACGrC,IAAI,CAACN,KAAL,KAAe,SAAf,iBACC,QAAC,UAAD;AACE,sCAAW,sBADb;AAEE,wBAAA,OAAO,EAAE,MAAMkB,aAAa,CAACZ,IAAD,EAAOlB,KAAK,CAACE,GAAb,CAF9B;AAAA,+CAIE,QAAC,oBAAD;AAAsB,0BAAA,QAAQ,EAAC;AAA/B;AAAA;AAAA;AAAA;AAAA;AAJF;AAAA;AAAA;AAAA;AAAA,8BAFJ,EASGgB,IAAI,CAACN,KAAL,KAAe,OAAf,iBACC,QAAC,QAAD;AACE,wBAAA,OAAO,EAAE,KADX;AAEE,wBAAA,QAAQ,EAAE,MAAM;AACd8B,0BAAAA,OAAO,CAAC1C,KAAK,CAACE,GAAP,EAAYgB,IAAZ,CAAP;AACD,yBAJH;AAKE,wBAAA,KAAK,EAAC;AALR;AAAA;AAAA;AAAA;AAAA,8BAVJ,EAkBGA,IAAI,CAACN,KAAL,KAAe,WAAf,iBACC,QAAC,QAAD;AACE,wBAAA,OAAO,EAAE,IADX;AAEE,wBAAA,QAAQ,EAAE,MAAM;AACd8B,0BAAAA,OAAO,CAAC1C,KAAK,CAACE,GAAP,EAAYgB,IAAZ,CAAP;AACD,yBAJH;AAKE,wBAAA,KAAK,EAAC;AALR;AAAA;AAAA;AAAA;AAAA,8BAnBJ;AAAA;AAAA;AAAA;AAAA;AAAA,4BAzBF,eAqDE,QAAC,SAAD;AAAW,sBAAA,SAAS,EAAC,IAArB;AAA0B,sBAAA,KAAK,EAAC,KAAhC;AAAA,iCACGA,IAAI,CAACN,KAAL,KAAe,SAAf,IAA4B,WAD/B,EAEGM,IAAI,CAACN,KAAL,KAAe,WAAf,IAA8B,YAFjC,EAGGM,IAAI,CAACN,KAAL,KAAe,OAAf,IAA0B,OAH7B,EAIGM,IAAI,CAACN,KAAL,KAAe,WAAf,IAA8B,SAJjC;AAAA;AAAA;AAAA;AAAA;AAAA,4BArDF;AAAA,qBAAe,CAAf;AAAA;AAAA;AAAA;AAAA,0BADD;AADH;AAAA;AAAA;AAAA;AAAA,wBAXF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cA1BF,eA8GE,QAAC,WAAD;AACE,QAAA,WAAW,EAAE0B,WADf;AAEE,QAAA,IAAI,EAAEM,IAFR;AAGE,QAAA,uBAAuB,EAAEvC,uBAH3B;AAIE,QAAA,eAAe,EAAEF;AAJnB;AAAA;AAAA;AAAA;AAAA,cA9GF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,UADF;AAyHD,CAtVD;;GAAMX,K;UAYYF,U,EAGWC,S,EAwCFV,W,EAmBMA,W,EAmBAA,W,EAmBTA,W,EAmBSA,W,EAwBPA,W,EACJA,W,EAmCCA,W;;;KA/LjBW,K;;AAwVN,MAAMgE,eAAe,GAAI5C,KAAD,IAAW;AACjC,SAAO;AACLnB,IAAAA,MAAM,EAAEmB,KAAK,CAACZ,KAAN,CAAYP;AADf,GAAP;AAGD,CAJD;;AAMA,MAAMgE,kBAAkB,GAAIC,QAAD,IAAc;AACvC,SAAO;AACLhE,IAAAA,MAAM,EAAGwB,IAAD,IAAUwC,QAAQ,CAACtF,UAAU,CAAC8C,IAAD,CAAX,CADrB;AAELvB,IAAAA,GAAG,EAAGuB,IAAD,IAAUwC,QAAQ,CAACrF,aAAa,CAAC6C,IAAD,CAAd,CAFlB;AAGLtB,IAAAA,GAAG,EAAGsB,IAAD,IAAUwC,QAAQ,CAACpF,aAAa,CAAC4C,IAAD,CAAd,CAHlB;AAIL3C,IAAAA,WAAW,EAAG4C,QAAD,IAAcuC,QAAQ,CAACnF,WAAW,CAAC4C,QAAD,CAAZ,CAJ9B;AAKLvC,IAAAA,UAAU,EAAGoE,MAAD,IAAYU,QAAQ,CAAC9E,UAAU,CAACoE,MAAD,CAAX,CAL3B;AAMLnD,IAAAA,eAAe,EAAG8D,OAAD,IAAaD,QAAQ,CAAClF,sBAAsB,CAACmF,OAAD,CAAvB,CANjC;AAOLlF,IAAAA,mBAAmB,EAAGkF,OAAD,IAAaD,QAAQ,CAACjF,mBAAmB,CAACkF,OAAD,CAApB,CAPrC;AAQLjF,IAAAA,eAAe,EAAGiF,OAAD,IAAaD,QAAQ,CAAChF,eAAe,CAACiF,OAAD,CAAhB,CARjC;AASLhF,IAAAA,SAAS,EAAGgF,OAAD,IAAaD,QAAQ,CAAC/E,SAAS,CAACgF,OAAD,CAAV;AAT3B,GAAP;AAWD,CAZD;;AAcA,eAAexF,OAAO,CAACqF,eAAD,EAAkBC,kBAAlB,CAAP,CAA6CjE,KAA7C,CAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Grid, Box, Checkbox } from \"@material-ui/core/\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport AddCircleOutlineIcon from \"@material-ui/icons/AddCircleOutline\";\nimport RemoveCircleOutlineIcon from \"@material-ui/icons/RemoveCircleOutline\";\nimport DeleteSweepIcon from \"@material-ui/icons/DeleteSweep\";\nimport Table from \"@material-ui/core/Table\";\nimport Paper from \"@material-ui/core/Paper\";\nimport TableBody from \"@material-ui/core/TableBody\";\nimport TableCell from \"@material-ui/core/TableCell\";\nimport TableContainer from \"@material-ui/core/TableContainer\";\nimport TableHead from \"@material-ui/core/TableHead\";\nimport TableRow from \"@material-ui/core/TableRow\";\nimport OrderFooter from \"./OrderFooter\";\nimport { connect } from \"react-redux\";\nimport {\n  removeItem,\n  incrementItem,\n  decrementItem,\n  removeOrder,\n  dishesPreparingToOrder,\n  changeDishDelivered,\n  changeDishReady,\n  billOrder,\n} from \"../../../redux/actions/orderAction\";\nimport { resetTable } from \"../../../redux/actions/tableAction\";\n// consulta a la  API Graphql\nimport { useMutation } from \"@apollo/react-hooks\";\nimport {\n  REMOVE_ITEM,\n  INCREMENT_ITEM,\n  DECREMENT_ITEM,\n  REMOVE_ORDER,\n  DISHES_PREPARING,\n  DISH_DELIVERED,\n  DISH_READY,\n  CLOSE_ORDER,\n} from \"../../../services/Mutations\";\nimport { useHistory } from \"react-router-dom\";\n\nimport { useParams } from \"react-router-dom\";\n\n//----- Componente de Menu de Items ---- //\n\nconst Order = ({\n  orders,\n  remove,\n  inc,\n  dec,\n  removeOrder,\n  resetTable,\n  dishesPreparing,\n  changeDishDelivered,\n  changeDishReady,\n  billOrder,\n}) => {\n  const history = useHistory();\n  // Recupera el id de la comanda que llega por parametro para filtrar\n  // la comanda a gestionar.\n  const { order_id_param } = useParams();\n  const order = orders.filter((order) => order._id === order_id_param)[0];\n\n  // Estados de los botones facturar y ordenar -> useEffect\n  const [desability_bill, setDesability_bill] = useState(true);\n  const [desability_send_kitchen, setDesability_send_kitchen] = useState(true);\n\n  useEffect(() => {\n    if (order.dishes === undefined) {\n      setDesability_send_kitchen(true);\n    } else {\n      if (order.dishes.length >= 0) {\n        let dishes_pending = order.dishes.filter(\n          (dish) => dish.state === \"pending\"\n        );\n        setDesability_send_kitchen(!dishes_pending.length > 0);\n      } else {\n        setDesability_send_kitchen(true);\n      }\n    }\n  }, [orders]);\n\n  useEffect(() => {\n    if (order.dishes === undefined) {\n      setDesability_bill(true);\n    } else {\n      if (order.dishes.length >= 0) {\n        let dishes_delivered = order.dishes.filter(\n          (dish) => dish.state === \"delivered\"\n        );\n        let hability = order.dishes.length === dishes_delivered.length;\n        let disable = order.dishes.length > 0 && hability;\n        setDesability_bill(!disable);\n      } else {\n        setDesability_bill(true);\n      }\n    }\n  }, [orders]);\n\n  // Eliminación de un plato de la comanda\n  const [popDishToOrder] = useMutation(REMOVE_ITEM);\n  const removeDish = async (item, order_id) => {\n    await popDishToOrder({\n      variables: {\n        order_id: order_id,\n        dish_id: item._id,\n      },\n    })\n      .then((result) => {\n        let { dishes } = result.data.popDishToOrder;\n        // console.log(dishes); //ya no se encuentra el item incluido\n        remove({ ...item, order_id });\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n\n  // Incrementa la cantidad de un item de un plato\n  const [incrementDishToOrder] = useMutation(INCREMENT_ITEM);\n  const incrementDish = async (item, order_id) => {\n    await incrementDishToOrder({\n      variables: {\n        order_id: order_id,\n        dish_id: item._id,\n      },\n    })\n      .then((result) => {\n        let { dishes } = result.data.incrementDishToOrder;\n        // console.log(\"Dishes: \", dishes); //aumento la cantidad\n        inc({ ...item, order_id });\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n\n  // Decrementa la cantidad de un item de un plato\n  const [decrementDishToOrder] = useMutation(DECREMENT_ITEM);\n  const decrementDish = async (item, order_id) => {\n    await decrementDishToOrder({\n      variables: {\n        order_id: order_id,\n        dish_id: item._id,\n      },\n    })\n      .then((result) => {\n        let { dishes } = result.data.decrementDishToOrder;\n        // console.log(\"Dishes: \", dishes); //aumento la cantidad\n        dec({ ...item, order_id });\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n\n  // Elimina la comanda\n  const [deleteOrder] = useMutation(REMOVE_ORDER);\n  const popOrder = async (order_id, table) => {\n    await deleteOrder({\n      variables: {\n        order_id: order_id,\n      },\n    })\n      .then((result) => {\n        // let { order } = result.data.deleteOrder;\n        history.push(\"/floor\");\n        removeOrder(order_id);\n        resetTable(table);\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n\n  // Cambia el estado de los platos y los envia a cocina\n  const [dishPreparingToOrder] = useMutation(DISHES_PREPARING);\n  const sendKitchen = async () => {\n    let order_id = order._id;\n    let dishes_pending = order.dishes.filter(\n      (dish) => dish.state === \"pending\"\n    );\n    let dishes = [];\n    dishes_pending.map((dish) => dishes.push(dish._id));\n    dishesPreparing({ dishes, order_id });\n    await dishPreparingToOrder({\n      variables: {\n        order_id: order_id,\n        dishes: dishes,\n      },\n    })\n      .then((result) => {\n        let { dishes } = result.data.dishPreparingToOrder;\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  };\n\n  // Checked de entrega. Gestiona la entrega de platos\n  const [dishDelivered] = useMutation(DISH_DELIVERED);\n  const [dishReady] = useMutation(DISH_READY);\n  const onTable = async (order_id, dish) => {\n    let dish_id = dish._id;\n    if (dish.state === \"ready\") {\n      changeDishDelivered({ order_id, dish_id });\n      await dishDelivered({\n        variables: {\n          order_id: order_id,\n          dish_id: dish_id,\n        },\n      })\n        .then((result) => {\n          let { order } = result.data.dishDelivered;\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n    } else {\n      changeDishReady({ order_id, dish_id });\n      await dishReady({\n        variables: {\n          order_id: order_id,\n          dish_id: dish_id,\n        },\n      })\n        .then((result) => {\n          let { order } = result.data.dishReady;\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n    }\n  };\n\n  // Gestiona el cierre de la comanda\n  const [closeOrder] = useMutation(CLOSE_ORDER);\n  const bill = async () => {\n    let items = order.dishes.length;\n    let total_delivered = order.dishes.filter(\n      (dish) => dish.state === \"delivered\"\n    ).length;\n    if (items === total_delivered && items > 0) {\n      let order_id = order._id;\n      billOrder(order_id);\n      resetTable(order.table);\n      history.push(\"/\");\n      await closeOrder({\n        variables: {\n          order_id: order_id,\n        },\n      })\n        .then((result) => {\n          // let { order } = result.data.closeOrder\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n    } else {\n      alert(\"Aun no se puede facturar\");\n    }\n  };\n\n  /*\n    Componente de comanda \n  */\n  return (\n    <div>\n      <Grid container spacing={0} justify=\"center\">\n        <Grid item md={12}>\n          <TableContainer>\n            <Table aria-label=\"simple table\">\n              <TableHead>\n                <TableRow>\n                  <TableCell>Comanda {order?.number}</TableCell>\n                  <TableCell>Mesa: {order?.table} </TableCell>\n                  <TableCell>Fecha: {order?.date}</TableCell>\n                  <TableCell>Hora: {order?.time} </TableCell>\n                  <TableCell>\n                    <IconButton aria-label=\"RemoveCircleOutlineIcon\">\n                      <DeleteSweepIcon\n                        fontSize=\"small\"\n                        onClick={() => {\n                          popOrder(order._id, order.table);\n                        }}\n                      />\n                    </IconButton>{\" \"}\n                  </TableCell>\n                </TableRow>\n              </TableHead>\n              <TableBody></TableBody>\n            </Table>\n          </TableContainer>\n        </Grid>\n        <Paper style={{ height: 400, width: \"95%\", overflow: \"auto\" }}>\n          <Grid item md={12}>\n            <Box m={2} mb={3}>\n              <TableContainer>\n                <Table aria-label=\"simple table\">\n                  <TableHead>\n                    <TableRow>\n                      <TableCell>Eliminar</TableCell>\n                      <TableCell>Item</TableCell>\n                      <TableCell align=\"center\">Quitar</TableCell>\n                      <TableCell align=\"center\">Cantidad</TableCell>\n                      <TableCell>Acción</TableCell>\n                      <TableCell>Estado</TableCell>\n                    </TableRow>\n                  </TableHead>\n                  <TableBody>\n                    {order.dishes?.map((item) => (\n                      <TableRow key={1}>\n                        <TableCell component=\"th\" scope=\"row\">\n                          <IconButton\n                            aria-label=\"delete\"\n                            onClick={() => removeDish(item, order._id)}\n                          >\n                            <DeleteIcon fontSize=\"small\" />\n                          </IconButton>\n                        </TableCell>\n                        <TableCell component=\"th\" scope=\"row\">\n                          {item.name}\n                        </TableCell>\n                        <TableCell component=\"th\" scope=\"row\" align=\"center\">\n                          {item.state === \"pending\" && item.count > 1 && (\n                            <IconButton\n                              aria-label=\"RemoveCircleOutlineIcon\"\n                              onClick={() => decrementDish(item, order._id)}\n                            >\n                              <RemoveCircleOutlineIcon fontSize=\"small\" />\n                            </IconButton>\n                          )}\n                        </TableCell>\n                        <TableCell component=\"th\" scope=\"row\" align=\"center\">\n                          {item.count}\n                        </TableCell>\n                        <TableCell component=\"th\" scope=\"row\">\n                          {item.state === \"pending\" && (\n                            <IconButton\n                              aria-label=\"AddCircleOutlineIcon\"\n                              onClick={() => incrementDish(item, order._id)}\n                            >\n                              <AddCircleOutlineIcon fontSize=\"small\" />\n                            </IconButton>\n                          )}\n                          {item.state === \"ready\" && (\n                            <Checkbox\n                              checked={false}\n                              onChange={() => {\n                                onTable(order._id, item);\n                              }}\n                              color=\"primary\"\n                            />\n                          )}\n                          {item.state === \"delivered\" && (\n                            <Checkbox\n                              checked={true}\n                              onChange={() => {\n                                onTable(order._id, item);\n                              }}\n                              color=\"primary\"\n                            />\n                          )}\n                        </TableCell>\n                        <TableCell component=\"th\" scope=\"row\">\n                          {item.state === \"pending\" && \"Pendiente\"}\n                          {item.state === \"preparing\" && \"Preparando\"}\n                          {item.state === \"ready\" && \"Listo\"}\n                          {item.state === \"delivered\" && \"En mesa\"}\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </TableContainer>\n            </Box>\n          </Grid>\n        </Paper>\n        <OrderFooter\n          sendKitchen={sendKitchen}\n          bill={bill}\n          desability_send_kitchen={desability_send_kitchen}\n          desability_bill={desability_bill}\n        />\n      </Grid>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  return {\n    orders: state.order.orders,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    remove: (item) => dispatch(removeItem(item)),\n    inc: (item) => dispatch(incrementItem(item)),\n    dec: (item) => dispatch(decrementItem(item)),\n    removeOrder: (order_id) => dispatch(removeOrder(order_id)),\n    resetTable: (number) => dispatch(resetTable(number)),\n    dishesPreparing: (payload) => dispatch(dishesPreparingToOrder(payload)),\n    changeDishDelivered: (payload) => dispatch(changeDishDelivered(payload)),\n    changeDishReady: (payload) => dispatch(changeDishReady(payload)),\n    billOrder: (payload) => dispatch(billOrder(payload)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Order);\n"]},"metadata":{},"sourceType":"module"}